```markdown
# Claude Code Mobile Terminal Relay

## Overview
This project provides a secure, persistent way to interact with the **Claude Code CLI** from an iPhone.  
Claude Code runs on a trusted host machine inside a pseudo-terminal (PTY).  
An iPhone-compatible client relays keyboard input and renders terminal output over a secure WebSocket connection.

This repository is designed to work **directly with Claude Code** using the accompanying `Claude.md` specification.

---

## Key Goals
- View a live Claude Code CLI session on an iPhone
- Type using the native iOS keyboard
- Preserve session state across disconnects
- Maintain strong security boundaries
- Keep the client thin and simple

---

## Non-Goals
- Running Claude Code natively on iOS
- Desktop streaming (VNC / RDP)
- Full terminal emulation on the client
- Direct Claude API usage
- Weak or optional authentication

---

## Architecture

```

[iPhone Client]
|
|  WebSocket (HTTPS)
|
[Relay Server]
|
|  PTY stdin/stdout
|
[Claude Code CLI]

```

The relay server owns the Claude Code process lifecycle and PTY.
Clients only send text input and receive rendered output.

---

## Repository Structure

```

.
├── Claude.md          # Authoritative design contract for Claude Code
├── README.md          # This file
├── server/            # Relay server implementation
│   ├── index.js
│   └── pty.js
├── client/            # iPhone-compatible client
│   ├── web/
│   └── ios/
└── docs/

````

---

## Backend Responsibilities

### Process Management
- Spawn one Claude Code instance per authenticated session
- Run Claude Code inside a PTY
- Preserve PTY state across disconnects
- Enforce idle timeout (default: 24 hours)
- Never restart Claude Code automatically

### I/O Handling
- Forward UTF-8 input to PTY stdin
- Stream stdout and stderr to clients
- Preserve ANSI escape sequences
- Maintain at least 10,000 lines of scrollback

### Transport
- WebSocket over HTTPS only
- Backpressure-aware streaming
- Rejection of unauthenticated connections

---

## Client Responsibilities

### Input
- Raw UTF-8 text from iOS keyboard
- Paste support
- Optional control keys:
  - ESC
  - CTRL+C
  - CTRL+D

### Output
- Monospaced terminal rendering
- Preserved whitespace and line breaks
- Optional ANSI color support
- Text selection and copy

### Connectivity
- Automatic reconnect
- Session resume without loss
- Graceful handling of network changes

---

## Messaging Protocol

### Client → Server

```json
{
  "type": "input",
  "data": "string"
}
````

```json
{
  "type": "control",
  "key": "CTRL_C"
}
```

### Server → Client

```json
{
  "type": "output",
  "data": "string"
}
```

```json
{
  "type": "status",
  "state": "connected | disconnected | error"
}
```

---

## Security Model

* HTTPS required for all traffic
* Token-based authentication
* Claude Code runs as a non-root user
* PTY isolated per session
* No raw input logging

---

## Recommended Technology

### Backend

* Node.js or Go
* PTY libraries:

  * `node-pty`
  * `creack/pty`
* WebSocket server with flow control

### Client

* Mobile web app (Safari-compatible)
* OR native SwiftUI app
* No embedded SSH logic

---

## Setup (High Level)

1. Install Claude Code on the host machine
2. Deploy relay server on the same host
3. Configure HTTPS and authentication
4. Launch relay server
5. Connect from iPhone client

---

## Testing Checklist

* Network drop during output
* Reconnect resumes same session
* Scrollback replay integrity
* Control key handling
* Multiple session isolation

---

## Acceptance Criteria

A user can:

* Open an iPhone client
* Connect securely
* Type naturally
* Interact with Claude Code in real time
* Disconnect and reconnect without losing context

---

## Design Philosophy

This system is a **terminal relay**, not a terminal emulator.

Claude Code remains authoritative.
The client remains intentionally thin.
Reliability, persistence, and security take priority over features.

---

## License

MIT

```
```
